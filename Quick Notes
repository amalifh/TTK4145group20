Implementation of nextState and nextOutput
